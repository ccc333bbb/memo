---
import { SITE_CONFIG } from '../config/site';

export interface Props {
  repo?: string;
  repoId?: string;
  category?: string;
  categoryId?: string;
  mapping?: string;
  strict?: boolean;
  reactionsEnabled?: boolean;
  emitMetadata?: boolean;
  inputPosition?: 'top' | 'bottom';
  theme?: 'light' | 'dark' | 'preferred_color_scheme' | 'purple_dark';
  lang?: string;
  loading?: 'lazy' | 'eager';
}

const props = Astro.props;
---

<div class="giscus-container">
  <div class="giscus" id="giscus"></div>
</div>

<script define:vars={{
  repo: props.repo ?? SITE_CONFIG.giscus.repo,
  repoId: props.repoId ?? SITE_CONFIG.giscus.repoId,
  category: props.category ?? SITE_CONFIG.giscus.category,
  categoryId: props.categoryId ?? SITE_CONFIG.giscus.categoryId,
  mapping: props.mapping ?? SITE_CONFIG.giscus.mapping,
  strict: props.strict ?? false,
  reactionsEnabled: props.reactionsEnabled ?? true,
  emitMetadata: props.emitMetadata ?? false,
  inputPosition: props.inputPosition ?? "bottom",
  theme: props.theme ?? SITE_CONFIG.giscus.theme,
  lang: props.lang ?? SITE_CONFIG.defaultLanguage,
  loading: props.loading ?? "lazy"
}}>
  const giscusScript = document.createElement('script');
  giscusScript.src = 'https://giscus.app/client.js';
  giscusScript.setAttribute('data-repo', repo);
  giscusScript.setAttribute('data-repo-id', repoId);
  giscusScript.setAttribute('data-category', category);
  giscusScript.setAttribute('data-category-id', categoryId);
  giscusScript.setAttribute('data-mapping', mapping);
  giscusScript.setAttribute('data-strict', strict ? '1' : '0');
  giscusScript.setAttribute('data-reactions-enabled', reactionsEnabled ? '1' : '0');
  giscusScript.setAttribute('data-emit-metadata', emitMetadata ? '1' : '0');
  giscusScript.setAttribute('data-input-position', inputPosition);
  giscusScript.setAttribute('data-theme', theme);
  giscusScript.setAttribute('data-lang', lang);
  giscusScript.setAttribute('data-loading', loading);
  giscusScript.crossOrigin = 'anonymous';
  giscusScript.async = true;
  
  document.getElementById('giscus')?.appendChild(giscusScript);
</script>

<style>
  .giscus-container {
    margin-top: 3rem;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }
  
  .giscus {
    width: 100%;
  }
  
  /* 響應式設計 */
  @media (max-width: 768px) {
    .giscus-container {
      padding: 1rem;
      margin-top: 2rem;
    }
  }
</style>
